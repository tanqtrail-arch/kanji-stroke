# TRAIL 教育ゲーム開発 統一仕様書（Claude Code用）

> **このファイルは新しいゲーム開発時に必ず読み込ませる共通ルール集です。**
> 末尾の `## 🎯 今回のゲーム固有設定` を毎回書き換えて使用してください。

---

## 1. 教育設計の基本方針（TRAILスタンス）

### 根本思想
- **「面白い！」が出発点**：情熱主義。子どもの「好き」を起点にする
- **自分で考える習慣を作る場所**：答えを教えるのではなく、問いを持たせる
- **知識あってこそプロセス**：知識の土台は軽視しない。その上で探究する
- **AI時代に必要な力**：問う力・表現力・発信力・協働力

### ゲーム設計への反映
- 単なるドリルにしない。「なぜ？」「もっと知りたい」を誘発する仕掛けを入れる
- 正解/不正解の二択で終わらせず、間違いから学べるフィードバックを設計する
- 可能な限り「選ぶ→考える→試す→振り返る」のサイクルを組み込む
- 子どもが夢中になるゲーム・アニメ的な演出を教育のエントリーポイントにする
- 競争だけでなく協働要素も意識する

---

## 2. UI/デザイン共通ルール

### 対象ユーザー
- **メインターゲット**: 小学生〜中学生（8〜15歳）
- **サブ**: 保護者（結果確認画面など）

### カラー＆テーマ
- 基本は**明るく・ポップ・親しみやすい**トーン
- 背景は白 or 薄いグレー系。目に優しく長時間プレイに耐える
- アクセントカラーはゲームのテーマに合わせて都度決定（例：理科系→グリーン、歴史系→ゴールド/ブラウン）
- **ダークモード不要**（子ども向けなので明るいUI優先）

### フォント
- 日本語：**Noto Sans JP**（Google Fonts CDN）を第一候補
- 英数字：`system-ui, -apple-system, sans-serif` フォールバック
- ゲームタイトルや強調部分はウェイト700〜900のボールド
- 本文・選択肢は16px以上（小学生が読みやすいサイズ）

### レイアウト
- **モバイルファースト**：TRAIL Game Pro内のiframe表示を想定
- 横幅 `max-width: 480px`（スマホ縦持ち基準）、`margin: 0 auto` で中央寄せ
- タッチ操作前提：ボタンは最低 `44px × 44px`（Apple HIG準拠）
- スクロールは最小限。1画面に収まる情報量を意識する

### ボタン・インタラクション
- ボタンは`border-radius: 8px〜12px` の角丸
- タップ時に視覚フィードバック（色変化 or スケールアニメーション）
- 正解時：🎉 緑系 + 短いアニメーション
- 不正解時：赤系フラッシュ（ただし威圧的にしない）+ 正解の解説表示
- 読み込み中はスピナー or スケルトンUIを表示

### 画面構成テンプレート
```
┌─────────────────────┐
│  ヘッダー（ゲーム名）    │  ← 固定 or スクロール追従
│  スコア / タイマー      │
├─────────────────────┤
│                     │
│   メインゲームエリア     │  ← 画面の60〜70%
│                     │
├─────────────────────┤
│  操作ボタン / 選択肢    │  ← 画面下部に固定配置推奨
└─────────────────────┘
```

### アニメーション
- CSS `transition` / `@keyframes` ベースで軽量に
- 過度なアニメーションは避ける（学習の邪魔にならない程度）
- 正解・レベルアップ・クリアなどの**ご褒美演出**はしっかり作る

### 効果音（任意）
- 音は必須ではないが、入れる場合はミュートボタン必須
- Web Audio API or `<audio>` タグ。ファイルは軽量なものを使用

---

## 3. 技術スタック・ファイル構成

### 基本方針
- **技術スタックはゲームごとに最適なものを選択**する（HTML単体/React/Canvas等）
- 以下は「どのスタックでも守るルール」

### 共通ルール

#### ファイル命名
- ケバブケース統一：`game-name.html`, `quiz-data.json`, `score-manager.js`
- ゲーム名は英語のケバブケース：`nengou-flash`, `timeline-battle`, `element-quest`

#### データ管理
- 問題データは**JSONまたはJS配列で外部化**（HTMLにベタ書きしない）
- データファイルの先頭にスキーマコメントを入れる：
```javascript
/**
 * @type {Array<{id: number, question: string, answer: string, hint?: string, difficulty: 1|2|3}>}
 */
const quizData = [ ... ];
```

#### 状態管理
- ゲームの状態（スコア、現在の問題番号、残りライフ等）は1つのオブジェクトにまとめる：
```javascript
const gameState = {
  score: 0,
  currentIndex: 0,
  lives: 3,
  combo: 0,
  startTime: null,
  isPlaying: false,
};
```

#### エラーハンドリング
- `try-catch` でデータ読み込みエラーを捕捉
- ネットワーク依存の機能が失敗しても、ゲーム本体は動作するようにする
- エラー時はユーザーにわかりやすいメッセージを表示

#### パフォーマンス
- 初回表示 3秒以内を目標
- 画像は圧縮済みのものを使用（WebP推奨）
- 不要なライブラリの読み込みを避ける

#### アクセシビリティ（最低限）
- ボタンには `aria-label` をつける
- 色だけに頼らない情報伝達（色覚多様性への配慮）
- キーボード操作対応は任意だが、タッチ操作は必須

---

## 4. ゲーミフィケーション仕様

### ALTポイントシステム
- **ALT（Alternative Learning Token）**はTRAIL共通のゲーム内通貨
- ゲーム内で獲得 → TRAIL Game Proのポイントに反映される想定

#### ポイント付与の基本ルール
| アクション | ALT目安 | 備考 |
|-----------|--------|------|
| 正解1問 | +10 ALT | 基本報酬 |
| 連続正解ボーナス | +5 × コンボ数 | 上限あり（例：最大+50） |
| ステージクリア | +50 ALT | 全問正解ボーナスは別途 |
| パーフェクトクリア | +100 ALT | 全問正解 |
| タイムボーナス | +10〜30 ALT | 制限時間ゲームのみ |
| 初回クリアボーナス | +200 ALT | 1回限り |
| デイリーログイン | +30 ALT | TRAIL Game Pro側で管理 |

#### 実装上の注意
- ALT付与のロジックはゲーム側で計算し、`postMessage` or API経由でTRAIL Game Proに送信
- 不正防止：スコア送信時にゲームのハッシュ値 or セッショントークンを付与
- ALTの表示は画面右上に常時表示（コイン風アイコン🪙 + 数値）

### ランキング機能
- ゲーム内スコアをTRAIL Game Proのランキングに反映
- ランキング表示は「トップ10 + 自分の順位」形式
- ニックネーム表示（本名は使わない）
- 送信データ形式（例）：
```javascript
const scoreData = {
  gameId: "nengou-flash",
  odai: "江戸時代",        // お題・ステージ名
  playerId: "student_xxx",
  playerName: "ニックネーム",
  score: 1500,
  alt: 120,
  combo: 8,
  accuracy: 0.85,         // 正答率
  time: 45.2,             // クリアタイム（秒）
  timestamp: "2025-xx-xx"
};
```

### 難易度設計
- **3段階を基本とする**：★☆☆ やさしい / ★★☆ ふつう / ★★★ むずかしい
- ゲーム開始前に選択させる or 自動調整（アダプティブ）
- 難易度による変化例：制限時間 / 選択肢の数 / ヒントの有無 / 問題の複雑さ

### 進捗・フィードバック
- クリア後に**リザルト画面**を必ず表示：
  - スコア、正答率、獲得ALT、コンボ数
  - 「もう一回」「ステージ選択に戻る」ボタン
  - 間違えた問題の一覧（復習機能）
- 学習データの蓄積を意識：「何を間違えたか」を記録できる設計にする

---

## 5. TRAIL Game Pro 連携仕様

### iframe 埋め込み前提
- ゲームはTRAIL Game Proから `<iframe>` で読み込まれる
- 親ウィンドウとの通信は `window.postMessage` を使用

### postMessage プロトコル（標準）
```javascript
// ゲーム → TRAIL Game Pro（スコア送信）
window.parent.postMessage({
  type: "GAME_SCORE",
  payload: {
    gameId: "game-name",
    score: 1500,
    alt: 120,
    accuracy: 0.85,
    details: { /* ゲーム固有データ */ }
  }
}, "*");

// ゲーム → TRAIL Game Pro（ゲーム状態通知）
window.parent.postMessage({
  type: "GAME_STATE",
  payload: {
    state: "started" | "paused" | "completed" | "failed"
  }
}, "*");

// TRAIL Game Pro → ゲーム（プレイヤー情報受信）
window.addEventListener("message", (event) => {
  if (event.data.type === "PLAYER_INFO") {
    const { playerId, playerName, settings } = event.data.payload;
    // ゲーム内で使用
  }
});
```

### スタンドアロン対応
- `postMessage` が届かない環境でも**ゲーム単体で動作**すること
- TRAIL Game Pro外でのテスト・デモが可能な状態を維持
- 連携機能は「あればベター」として、なくても遊べる設計にする

---

## 6. コード品質・開発ルール

### コメント
- ファイル先頭にゲーム名・概要・作成日を記載
- 主要な関数にはJSDocコメント
- 「なぜそうしたか」のコメントを重視（What よりも Why）

### テスト
- 最低限、データの整合性チェック（問題データに必須フィールドがあるか等）
- ゲームのメインループが正常に動作することの確認

### バージョン管理
- ファイル先頭にバージョン番号を記載：`// v1.0.0 - 初期リリース`
- 大きな変更時はバージョンを更新

---

## 🎯 今回のゲーム固有設定

> **ここから下を毎回書き換えてください**

### ゲーム基本情報
- **ゲーム名**：（例：nengou-flash）
- **日本語タイトル**：（例：年号フラッシュ）
- **ジャンル**：（例：タイムアタッククイズ）
- **教科・単元**：（例：社会・日本史の年号）
- **対象学年**：（例：小4〜中3）

### 技術スタック
- **採用技術**：（例：HTML/CSS/JS 単一ファイル）
- **外部ライブラリ**：（例：なし / Chart.js / Three.js）
- **特記事項**：（例：Canvas使用 / Web Audio API使用）

### ゲーム固有ルール
- **ゲームの流れ**：（ここに具体的なゲームフローを記述）
- **勝利条件**：
- **敗北条件**：
- **ALTポイント調整**：（標準から変更がある場合）

### 問題データ仕様
```javascript
// このゲームの問題データ構造
const questionSchema = {
  // 例：
  id: "number",
  year: "number",
  event: "string",
  hint: "string",
  difficulty: "1|2|3"
};
```

### 追加の指示
- （ゲーム固有の特別な指示があればここに記載）

---

> **使い方**: このファイルをClaude Codeのプロジェクトに配置し、
> 新ゲーム開発開始時に「TRAIL_GAME_SPEC.md を読み込んで、今回は〇〇ゲームを作って」と指示してください。
> 末尾の「今回のゲーム固有設定」セクションを埋めてから渡すと、より精度の高い開発が可能です。
