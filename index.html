<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>漢字の成り立ち — kanji-stroke</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div id="app">
    <!-- ======== ヘッダー ======== -->
    <header id="header">
      <button id="btn-back" class="header-btn" aria-label="戻る" style="display:none;">←</button>
      <h1 id="header-title">漢字の成り立ち</h1>
      <div id="alt-display" class="alt-badge" aria-label="ALTポイント">🪙 <span id="alt-count">0</span></div>
    </header>

    <!-- ======== ホーム画面 ======== -->
    <section id="screen-home" class="screen active">
      <div class="home-hero">
        <div class="home-icon">漢</div>
        <h2 class="home-title">漢字の成り立ち</h2>
        <p class="home-subtitle">書き順アニメーションで楽しく学ぼう</p>
      </div>
      <nav class="home-menu">
        <button class="menu-btn" data-action="grade-select">
          <span class="menu-icon">✏️</span>
          <span class="menu-label">学年べつ学習</span>
          <span class="menu-desc">書き順をみる</span>
        </button>
        <button class="menu-btn" data-action="quiz">
          <span class="menu-icon">❓</span>
          <span class="menu-label">クイズ</span>
          <span class="menu-desc">読み・画数・書き順</span>
        </button>
        <button class="menu-btn" data-action="puzzle">
          <span class="menu-icon">🧩</span>
          <span class="menu-label">部首パズル</span>
          <span class="menu-desc">パーツを組み合わせよう</span>
        </button>
        <button class="menu-btn" data-action="mypage">
          <span class="menu-icon">👤</span>
          <span class="menu-label">マイページ</span>
          <span class="menu-desc">進捗・バッジ</span>
        </button>
      </nav>
    </section>

    <!-- ======== 学年選択画面 ======== -->
    <section id="screen-grade-select" class="screen">
      <div class="grade-grid">
        <button class="grade-card" data-grade="1" style="--grade-color:#FF6B6B">
          <span class="grade-num">小1</span>
          <span class="grade-count">80字</span>
          <span class="grade-progress" data-grade-progress="1">0%</span>
        </button>
        <button class="grade-card" data-grade="2" style="--grade-color:#FF9F43">
          <span class="grade-num">小2</span>
          <span class="grade-count">160字</span>
          <span class="grade-progress" data-grade-progress="2">0%</span>
        </button>
        <button class="grade-card" data-grade="3" style="--grade-color:#FECA57">
          <span class="grade-num">小3</span>
          <span class="grade-count">200字</span>
          <span class="grade-progress" data-grade-progress="3">0%</span>
        </button>
        <button class="grade-card" data-grade="4" style="--grade-color:#48DBFB">
          <span class="grade-num">小4</span>
          <span class="grade-count">202字</span>
          <span class="grade-progress" data-grade-progress="4">0%</span>
        </button>
        <button class="grade-card" data-grade="5" style="--grade-color:#0ABDE3">
          <span class="grade-num">小5</span>
          <span class="grade-count">193字</span>
          <span class="grade-progress" data-grade-progress="5">0%</span>
        </button>
        <button class="grade-card" data-grade="6" style="--grade-color:#8E44AD">
          <span class="grade-num">小6</span>
          <span class="grade-count">191字</span>
          <span class="grade-progress" data-grade-progress="6">0%</span>
        </button>
      </div>
    </section>

    <!-- ======== 漢字一覧画面 ======== -->
    <section id="screen-kanji-list" class="screen">
      <div id="kanji-list-header" class="list-header">
        <span id="list-grade-label">小1の漢字</span>
        <span id="list-studied-count">0 / 80</span>
      </div>
      <div id="kanji-grid" class="kanji-grid">
        <!-- 動的に生成 -->
      </div>
      <div id="kanji-grid-skeleton" class="kanji-grid skeleton" style="display:none;">
        <div class="skel-cell"></div><div class="skel-cell"></div><div class="skel-cell"></div>
        <div class="skel-cell"></div><div class="skel-cell"></div><div class="skel-cell"></div>
        <div class="skel-cell"></div><div class="skel-cell"></div><div class="skel-cell"></div>
        <div class="skel-cell"></div><div class="skel-cell"></div><div class="skel-cell"></div>
        <div class="skel-cell"></div><div class="skel-cell"></div><div class="skel-cell"></div>
        <div class="skel-cell"></div><div class="skel-cell"></div><div class="skel-cell"></div>
      </div>
    </section>

    <!-- ======== 漢字詳細画面 ======== -->
    <section id="screen-kanji-detail" class="screen">
      <div class="detail-kanji-header">
        <span id="detail-char" class="detail-char">日</span>
        <div class="detail-meta">
          <span id="detail-stroke-count" class="detail-stroke-info">4画</span>
          <span id="detail-reading" class="detail-reading"></span>
        </div>
      </div>

      <!-- タブ -->
      <div class="detail-tabs">
        <button class="tab-btn active" data-tab="stroke">書き順</button>
        <button class="tab-btn" data-tab="info">成り立ち</button>
      </div>

      <!-- 書き順タブ -->
      <div id="tab-stroke" class="tab-content active">
        <div class="stroke-area">
          <svg id="stroke-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 109 109" width="260" height="260">
            <!-- 十字ガイド -->
            <line class="guide" x1="54.5" y1="0" x2="54.5" y2="109"/>
            <line class="guide" x1="0" y1="54.5" x2="109" y2="54.5"/>
            <!-- ストロークはJSで動的追加 -->
            <g id="ghost-group"></g>
            <g id="stroke-group"></g>
            <g id="number-group"></g>
          </svg>
        </div>
        <div class="stroke-progress">
          <div id="stroke-progress-bar" class="progress-bar">
            <div id="stroke-progress-fill" class="progress-fill"></div>
          </div>
          <span id="stroke-progress-text" class="progress-text">0 / 4</span>
        </div>
        <div class="stroke-controls">
          <button id="btn-auto" class="ctrl-btn" aria-label="自動再生">▶ 自動再生</button>
          <button id="btn-next" class="ctrl-btn" aria-label="次の画">次の画 →</button>
          <button id="btn-reset" class="ctrl-btn ctrl-btn-secondary" aria-label="リセット">↻ リセット</button>
        </div>
      </div>

      <!-- 成り立ちタブ -->
      <div id="tab-info" class="tab-content">
        <div id="formation-content" class="formation-content">
          <p class="formation-placeholder">このかんじの成り立ちデータはまだありません。</p>
        </div>
      </div>

      <!-- 前後ナビ -->
      <div class="detail-nav">
        <button id="btn-prev-kanji" class="nav-btn" aria-label="前の漢字">← 前</button>
        <button id="btn-next-kanji" class="nav-btn" aria-label="次の漢字">次 →</button>
      </div>
    </section>

    <!-- ======== クイズ: タイプ選択画面 ======== -->
    <section id="screen-quiz-menu" class="screen">
      <p class="section-lead">クイズのしゅるいをえらぼう</p>
      <div class="quiz-type-grid">
        <button class="quiz-type-card" data-quiz-type="reading">
          <span class="qt-icon">あ</span>
          <span class="qt-label">読みクイズ</span>
          <span class="qt-desc">漢字の読みを当てよう</span>
        </button>
        <button class="quiz-type-card" data-quiz-type="strokeCount">
          <span class="qt-icon">画</span>
          <span class="qt-label">画数クイズ</span>
          <span class="qt-desc">何画か当てよう</span>
        </button>
        <button class="quiz-type-card" data-quiz-type="strokeOrder">
          <span class="qt-icon">筆</span>
          <span class="qt-label">書き順クイズ</span>
          <span class="qt-desc">N画目はどれ？</span>
        </button>
        <button class="quiz-type-card" data-quiz-type="meaning">
          <span class="qt-icon">意</span>
          <span class="qt-label">意味クイズ</span>
          <span class="qt-desc">漢字の意味を当てよう</span>
        </button>
      </div>
    </section>

    <!-- ======== クイズ: 学年選択画面 ======== -->
    <section id="screen-quiz-grade" class="screen">
      <p class="section-lead">学年をえらぼう</p>
      <div class="grade-grid" id="quiz-grade-grid">
        <button class="grade-card" data-quiz-grade="1" style="--grade-color:#FF6B6B">
          <span class="grade-num">小1</span><span class="grade-count">80字</span>
        </button>
        <button class="grade-card" data-quiz-grade="2" style="--grade-color:#FF9F43">
          <span class="grade-num">小2</span><span class="grade-count">160字</span>
        </button>
        <button class="grade-card" data-quiz-grade="3" style="--grade-color:#FECA57">
          <span class="grade-num">小3</span><span class="grade-count">200字</span>
        </button>
        <button class="grade-card" data-quiz-grade="4" style="--grade-color:#48DBFB">
          <span class="grade-num">小4</span><span class="grade-count">202字</span>
        </button>
        <button class="grade-card" data-quiz-grade="5" style="--grade-color:#0ABDE3">
          <span class="grade-num">小5</span><span class="grade-count">193字</span>
        </button>
        <button class="grade-card" data-quiz-grade="6" style="--grade-color:#8E44AD">
          <span class="grade-num">小6</span><span class="grade-count">191字</span>
        </button>
      </div>
    </section>

    <!-- ======== クイズ: 出題画面 ======== -->
    <section id="screen-quiz-play" class="screen">
      <div class="quiz-hud">
        <span id="quiz-progress">1 / 10</span>
        <span id="quiz-combo" class="quiz-combo" style="display:none;"></span>
        <span id="quiz-score-display">0 pt</span>
      </div>
      <div id="quiz-question-area" class="quiz-question-area">
        <!-- 問題文: JSで動的生成 -->
      </div>
      <div id="quiz-choices" class="quiz-choices">
        <!-- 選択肢: JSで動的生成 -->
      </div>
      <div id="quiz-feedback" class="quiz-feedback" style="display:none;">
        <div id="quiz-feedback-icon" class="qf-icon"></div>
        <div id="quiz-feedback-text" class="qf-text"></div>
        <button id="quiz-next-btn" class="ctrl-btn">次の問題 →</button>
      </div>
    </section>

    <!-- ======== クイズ: リザルト画面 ======== -->
    <section id="screen-quiz-result" class="screen">
      <div class="result-card">
        <div id="result-icon" class="result-icon">🎉</div>
        <h2 id="result-title" class="result-title">クイズ終了！</h2>
        <div class="result-stats">
          <div class="stat-row">
            <span class="stat-label">スコア</span>
            <span id="result-score" class="stat-value">0</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">正答率</span>
            <span id="result-accuracy" class="stat-value">0%</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">最大コンボ</span>
            <span id="result-combo" class="stat-value">0</span>
          </div>
          <div class="stat-row alt-row">
            <span class="stat-label">獲得ALT</span>
            <span id="result-alt" class="stat-value">+0</span>
          </div>
        </div>
        <!-- 🆕 ALT獲得表示 -->
        <div id="altEarnedDisplay" style="display:none; text-align:center; padding:10px; margin:10px 0; background:linear-gradient(135deg,rgba(255,204,34,0.15),rgba(255,170,0,0.1)); border:1px solid rgba(255,204,34,0.3); border-radius:12px; font-weight:900; color:#886600; font-size:16px;">💰 +<span id="altEarnedVal">0</span> ALT ゲット！</div>
        <div id="result-mistakes" class="result-mistakes" style="display:none;">
          <h3>まちがえた問題</h3>
          <ul id="result-mistakes-list"></ul>
        </div>
        <div class="result-actions">
          <button id="result-retry" class="ctrl-btn">もう一回</button>
          <button id="result-home" class="ctrl-btn ctrl-btn-secondary">ホームへ</button>
        </div>
      </div>
    </section>

    <!-- ======== パズル: 難易度選択画面 ======== -->
    <section id="screen-puzzle-menu" class="screen">
      <p class="section-lead">むずかしさをえらぼう</p>
      <div class="puzzle-diff-grid">
        <button class="puzzle-diff-card" data-puzzle-diff="1">
          <span class="pd-stars">★☆☆</span>
          <span class="pd-label">やさしい</span>
          <span class="pd-desc">時間制限なし</span>
        </button>
        <button class="puzzle-diff-card" data-puzzle-diff="2">
          <span class="pd-stars">★★☆</span>
          <span class="pd-label">ふつう</span>
          <span class="pd-desc">60秒で回答</span>
        </button>
        <button class="puzzle-diff-card" data-puzzle-diff="3">
          <span class="pd-stars">★★★</span>
          <span class="pd-label">むずかしい</span>
          <span class="pd-desc">40秒で回答</span>
        </button>
      </div>
      <p class="section-lead" style="margin-top:20px;">学年をえらぶ</p>
      <div class="grade-grid" id="puzzle-grade-grid">
        <button class="grade-card puzzle-grade-btn" data-puzzle-grade="0" style="--grade-color:#E85D3A">
          <span class="grade-num">全部</span><span class="grade-count">671問</span>
        </button>
        <button class="grade-card puzzle-grade-btn" data-puzzle-grade="1" style="--grade-color:#FF6B6B">
          <span class="grade-num">小1</span><span class="grade-count">20問</span>
        </button>
        <button class="grade-card puzzle-grade-btn" data-puzzle-grade="2" style="--grade-color:#FF9F43">
          <span class="grade-num">小2</span><span class="grade-count">63問</span>
        </button>
        <button class="grade-card puzzle-grade-btn" data-puzzle-grade="3" style="--grade-color:#FECA57">
          <span class="grade-num">小3</span><span class="grade-count">109問</span>
        </button>
        <button class="grade-card puzzle-grade-btn" data-puzzle-grade="4" style="--grade-color:#48DBFB">
          <span class="grade-num">小4</span><span class="grade-count">137問</span>
        </button>
        <button class="grade-card puzzle-grade-btn" data-puzzle-grade="5" style="--grade-color:#0ABDE3">
          <span class="grade-num">小5</span><span class="grade-count">173問</span>
        </button>
        <button class="grade-card puzzle-grade-btn" data-puzzle-grade="6" style="--grade-color:#8E44AD">
          <span class="grade-num">小6</span><span class="grade-count">169問</span>
        </button>
      </div>
    </section>

    <!-- ======== パズル: プレイ画面 ======== -->
    <section id="screen-puzzle-play" class="screen">
      <div class="quiz-hud">
        <span id="puzzle-progress">0 / 5</span>
        <span id="puzzle-timer" class="puzzle-timer" style="display:none;">60s</span>
        <span id="puzzle-score-display">0 pt</span>
      </div>
      <p class="puzzle-lead">カードを2枚えらんで漢字をつくろう</p>
      <div id="puzzle-cards" class="puzzle-cards">
        <!-- 動的生成: 10枚のカード -->
      </div>
      <div id="puzzle-completed" class="puzzle-completed">
        <!-- 完成した漢字が並ぶ -->
      </div>
      <div id="puzzle-match-msg" class="puzzle-match-msg" style="display:none;"></div>
    </section>

    <!-- ======== パズル: リザルト画面 ======== -->
    <section id="screen-puzzle-result" class="screen">
      <div class="result-card">
        <div id="puzzle-result-icon" class="result-icon">🧩</div>
        <h2 id="puzzle-result-title" class="result-title">パズル終了！</h2>
        <div class="result-stats">
          <div class="stat-row">
            <span class="stat-label">スコア</span>
            <span id="puzzle-result-score" class="stat-value">0</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">正答率</span>
            <span id="puzzle-result-accuracy" class="stat-value">0%</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">最大コンボ</span>
            <span id="puzzle-result-combo" class="stat-value">0</span>
          </div>
          <div class="stat-row alt-row">
            <span class="stat-label">獲得ALT</span>
            <span id="puzzle-result-alt" class="stat-value">+0</span>
          </div>
        </div>
        <!-- 🆕 ALT獲得表示（パズル） -->
        <div id="puzzleAltEarnedDisplay" style="display:none; text-align:center; padding:10px; margin:10px 0; background:linear-gradient(135deg,rgba(255,204,34,0.15),rgba(255,170,0,0.1)); border:1px solid rgba(255,204,34,0.3); border-radius:12px; font-weight:900; color:#886600; font-size:16px;">💰 +<span id="puzzleAltEarnedVal">0</span> ALT ゲット！</div>
        <div id="puzzle-result-mistakes" class="result-mistakes" style="display:none;">
          <h3>まちがえた問題</h3>
          <ul id="puzzle-result-mistakes-list"></ul>
        </div>
        <div class="result-actions">
          <button id="puzzle-result-retry" class="ctrl-btn">もう一回</button>
          <button id="puzzle-result-home" class="ctrl-btn ctrl-btn-secondary">ホームへ</button>
        </div>
      </div>
    </section>

    <!-- ======== マイページ画面 ======== -->
    <section id="screen-mypage" class="screen">
      <!-- レベル & ALT -->
      <div class="mypage-level-card">
        <div class="level-badge" id="mypage-level">Lv.1</div>
        <div class="level-info">
          <div class="level-alt">🪙 <span id="mypage-alt">0</span> ALT</div>
          <div class="level-bar-wrap">
            <div class="progress-bar"><div id="mypage-level-fill" class="progress-fill"></div></div>
            <span id="mypage-level-next" class="level-next-text">次のレベルまで 50 ALT</span>
          </div>
        </div>
      </div>

      <!-- 学年べつ進捗 -->
      <div class="mypage-section">
        <h3 class="mypage-heading">学年べつ進捗</h3>
        <div id="mypage-grade-grid" class="mypage-grade-grid">
          <!-- 動的生成 -->
        </div>
      </div>

      <!-- にがてな漢字 -->
      <div id="mypage-weak-section" class="mypage-section" style="display:none;">
        <h3 class="mypage-heading">にがてな漢字 <span id="mypage-weak-count">0</span></h3>
        <div id="mypage-weak-list" class="weak-kanji-list">
          <!-- 動的生成 -->
        </div>
        <div style="text-align:center;margin-top:12px;">
          <button id="mypage-review-btn" class="ctrl-btn">復習クイズ →</button>
        </div>
      </div>

      <!-- 学習統計 -->
      <div class="mypage-section">
        <h3 class="mypage-heading">学習のきろく</h3>
        <div class="stats-grid">
          <div class="stats-card">
            <span class="sc-value" id="mypage-studied">0</span>
            <span class="sc-label">学習した漢字</span>
          </div>
          <div class="stats-card">
            <span class="sc-value" id="mypage-quiz-correct">0</span>
            <span class="sc-label">クイズ正解</span>
          </div>
          <div class="stats-card">
            <span class="sc-value" id="mypage-puzzle-correct">0</span>
            <span class="sc-label">パズル正解</span>
          </div>
          <div class="stats-card">
            <span class="sc-value" id="mypage-max-combo">0</span>
            <span class="sc-label">最大コンボ</span>
          </div>
        </div>
      </div>

      <!-- バッジコレクション -->
      <div class="mypage-section">
        <h3 class="mypage-heading">バッジ <span id="mypage-badge-count">0 / 12</span></h3>
        <div id="badge-grid" class="badge-grid">
          <!-- 動的生成 -->
        </div>
      </div>
    </section>

    <!-- ======== レベルアップモーダル ======== -->
    <div id="levelup-modal" class="modal-overlay" style="display:none;">
      <div class="modal-card levelup-card">
        <div class="levelup-icon">🎊</div>
        <h2 class="levelup-title">レベルアップ！</h2>
        <div id="levelup-level" class="levelup-level">Lv.2</div>
        <button id="levelup-close" class="ctrl-btn">やったー！</button>
      </div>
    </div>

    <!-- ======== バッジ獲得モーダル ======== -->
    <div id="badge-modal" class="modal-overlay" style="display:none;">
      <div class="modal-card badge-unlock-card">
        <div id="badge-modal-icon" class="badge-modal-icon">🐣</div>
        <h2 class="badge-modal-title">バッジ獲得！</h2>
        <div id="badge-modal-name" class="badge-modal-name">はじめの一歩</div>
        <div id="badge-modal-desc" class="badge-modal-desc">初めて書き順アニメを見た</div>
        <button id="badge-modal-close" class="ctrl-btn">うれしい！</button>
      </div>
    </div>

    <!-- ======== フッター ======== -->
    <footer id="footer">
      <p>書き順データ: <a href="http://kanjivg.tagaini.net" target="_blank" rel="noopener">KanjiVG</a> (CC BY-SA 3.0)</p>
    </footer>
  </div>

  <script src="js/stroke-animator.js"></script>
  <script src="js/quiz-engine.js"></script>
  <script src="js/stroke-reviewer.js"></script>
  <script src="js/bushu-puzzle.js"></script>
  <script src="js/badge-manager.js"></script>
  <script src="js/score-manager.js"></script>
  <script src="js/app.js"></script>
  <!-- ===== 🆕 TRAIL共通ナビ ===== -->
  <script src="trail-nav.js"></script>
  <script>
  TrailNav.init({
    gameName: '書き順マスター',
    gameEmoji: '✍️',
    gameHomeId: 'screen-home',
    tgp32Url: 'https://trail-game-pro-3-2.onrender.com',
    apiBase: 'https://trail-game-pro-3-2.onrender.com/api',
  });
  </script>
</body>
</html>
